<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>MPC Policy Rate Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <!-- Plotly for charts -->
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
  <!-- PapaParse for CSV parsing -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <!-- jsPDF + svg2pdf for vector PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highstock/6.0.3/lib/svg2pdf.js"></script>
  <!-- Custom styles -->
   <link rel="stylesheet" href="css/policy_dashboard.css">
  <!-- GoatCounter analytics -->
   <script data-goatcounter="https://nickylab.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
</head>
<body>

<header>
  <h1>MPC Policy Rate Projection Dashboard</h1>
  <p class="lede">
    Upload MPC projections (chartpackcsv), then compare output gaps and policy rate projections across scenarios.
  </p>
</header>

<main>
  <!-- Step 1: config and upload -->
  <section id="config-step" class="card">
    <h2>1. Upload projection files</h2>
    <div id="scenario-list"></div>
    <button id="add-scenario" class="btn btn-ghost">+ Add scenario</button>

    <div class="step-actions">
      <!-- Button moved to range-config; this area stays empty to keep spacing if needed -->
    </div>
  </section>

  <!-- Step 1.5: range configuration -->
  <section id="range-config" class="card">
    <h2>2. Set plot and table ranges</h2>
    <p style="font-size:13px;color:var(--muted);margin-bottom:10px;">
      Define the common time ranges used for all charts and tables. Leave fields blank to use defaults.
    </p>

    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;align-items:flex-start;max-width:100%;">
      <!-- Plot range -->
      <div>
        <label style="font-size:12px;color:var(--muted);display:block;margin-bottom:4px;">
          Plot range (all charts)
        </label>
        <div class="range-row">
          <select id="plot-min" class="range-input"></select>
          <span class="range-sep">to</span>
          <select id="plot-max" class="range-input"></select>
        </div>
        <div class="range-hint">Default: 2019Q4–2030Q4</div>
      </div>

      <!-- Actual data range -->
      <div>
        <label style="font-size:12px;color:var(--muted);display:block;margin-bottom:4px;">
          Actual data range (shaded)
        </label>
        <div class="range-row">
          <select id="actual-min" class="range-input" disabled></select>
          <span class="range-sep">to</span>
          <select id="actual-max" class="range-input"></select>
        </div>
        <div class="range-hint">Default: 2019Q4–current quarter</div>
      </div>

      <!-- Table range -->
      <div>
        <label style="font-size:12px;color:var(--muted);display:block;margin-bottom:4px;">
          Table range
        </label>
        <div class="range-row">
          <select id="table-min" class="range-input"></select>
          <span class="range-sep">to</span>
          <select id="table-max" class="range-input"></select>
        </div>
        <div class="range-hint">Default: 2019Q4–2030Q4</div>
      </div>
    </div>
    <div class="step-actions">
      <button id="build-dashboard" class="btn btn-primary">Build dashboard</button>
    </div>
  </section>

  <!-- Step 2: dashboard -->
  <section id="dashboard-step">
    <div class="card" style="margin-bottom:20px;">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap;">
        <h2 style="margin:0;">Interactive dashboard</h2>
        <div style="display:flex;align-items:center;gap:8px;">
        <span class="pill" id="scenario-count-label"></span>
        <div id="download-wrapper" class="download-wrapper">
          <button id="download-toggle" class="btn btn-primary">Download</button>
          <div id="download-menu" class="download-menu">
            <button type="button" id="download-html-parent">As HTML ▸</button>
            <div id="download-html-submenu" class="download-submenu">
              <button type="button" data-download="html-interactive">Interactive</button>
              <button type="button" data-download="html-fixed">Snapshot</button>
            </div>
            <button type="button" data-download="pdf">As PDF</button>
          </div>
        </div>
        <button id="back-to-config" class="btn btn-ghost">Back to file selection</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div id="scenario-legend" style="margin-bottom:8px;font-size:11px;color:var(--muted);"></div>
      <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap;margin-bottom:8px;">
        <h3 style="margin:0;font-size:14px;">Charts</h3>
        <div id="chart-toggle-row" style="display:flex;flex-wrap:wrap;gap:8px;font-size:11px;color:var(--muted);">
          <label class="chart-pill-label" style="display:inline-flex;align-items:center;gap:4px;">
            <input type="checkbox" class="chart-toggle" data-chart-id="chart-output-gap" checked>
            <span>Output Gap</span>
          </label>
          <label class="chart-pill-label" style="display:inline-flex;align-items:center;gap:4px;">
            <input type="checkbox" class="chart-toggle" data-chart-id="chart-output-levels" checked>
            <span>Output &amp; Potential</span>
          </label>
          <label class="chart-pill-label" style="display:inline-flex;align-items:center;gap:4px;">
            <input type="checkbox" class="chart-toggle" data-chart-id="chart-headline-yoy" checked>
            <span>Headline YoY</span>
          </label>
          <label class="chart-pill-label" style="display:inline-flex;align-items:center;gap:4px;">
            <input type="checkbox" class="chart-toggle" data-chart-id="chart-core-yoy">
            <span>Core YoY</span>
          </label>
          <label class="chart-pill-label" style="display:inline-flex;align-items:center;gap:4px;">
            <input type="checkbox" class="chart-toggle" data-chart-id="chart-policy" checked>
            <span>Policy Rate</span>
          </label>
          <label class="chart-pill-label" style="display:inline-flex;align-items:center;gap:4px;">
            <input type="checkbox" class="chart-toggle" data-chart-id="chart-policy-step">
            <span>Policy Rate (step)</span>
          </label>
          <label class="chart-pill-label" style="display:inline-flex;align-items:center;gap:4px;">
            <input type="checkbox" class="chart-toggle" data-chart-id="chart-potential-growth">
            <span>Potential Growth</span>
          </label>
          <label class="chart-pill-label" style="display:inline-flex;align-items:center;gap:4px;">
            <input type="checkbox" class="chart-toggle" data-chart-id="chart-core-qoq">
            <span>Core QoQ</span>
          </label>
          <label class="chart-pill-label" style="display:inline-flex;align-items:center;gap:4px;">
            <input type="checkbox" class="chart-toggle" data-chart-id="chart-headline-qoq">
            <span>Headline QoQ</span>
          </label>
        </div>
      </div>
      <div class="charts-grid">
        <div class="chart-box" id="chart-output-gap"></div>
        <div class="chart-box" id="chart-output-levels"></div>
        <div class="chart-box" id="chart-headline-yoy"></div>
        <div class="chart-box" id="chart-core-yoy"></div>
        <div class="chart-box" id="chart-policy"></div>
        <div class="chart-box" id="chart-policy-step"></div>
        <div class="chart-box" id="chart-potential-growth"></div>
        <div class="chart-box" id="chart-core-qoq"></div>
        <div class="chart-box" id="chart-headline-qoq"></div>
      </div>
    </div>

    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px;gap:12px;flex-wrap:wrap;">
        <h3 style="margin:0;font-size:14px;">Summary table</h3>
        <div id="summary-var-controls" style="display:flex;flex-direction:column;gap:6px;flex:1;min-width:0;">
          <!-- View (Q vs Y) -->
          <div style="display:inline-flex;align-items:center;gap:8px;flex-wrap:wrap;">
            <span style="font-size:11px;color:var(--muted);">View:</span>
            <label class="table-var-toggle">
              <input type="radio" class="table-frequency-radio" name="table-frequency" value="quarterly" checked>
              <span>Quarterly</span>
            </label>
            <label class="table-var-toggle">
              <input type="radio" class="table-frequency-radio" name="table-frequency" value="yearly">
              <span>Yearly</span>
            </label>
          </div>
          <!-- Variables -->
          <div>
            <span style="display:inline-block;margin-bottom:2px;font-size:11px;color:var(--muted);">Variables:</span>
            <div class="table-vars">
              <label class="table-var-toggle">
                <input type="checkbox" class="table-var-checkbox" data-var-id="ygap" checked>
                <span>Output Gap</span>
              </label>
              <label class="table-var-toggle">
                <input type="checkbox" class="table-var-checkbox" data-var-id="policy" checked>
                <span>Policy Rate</span>
              </label>
              <label class="table-var-toggle">
                <input type="checkbox" class="table-var-checkbox" data-var-id="policyStep" checked>
                <span>Policy Rate (step)</span>
              </label>
              <label class="table-var-toggle">
                <input type="checkbox" class="table-var-checkbox" data-var-id="headlineYoy">
                <span>Headline YoY</span>
              </label>
              <label class="table-var-toggle">
                <input type="checkbox" class="table-var-checkbox" data-var-id="coreYoy">
                <span>Core YoY</span>
              </label>
              <label class="table-var-toggle">
                <input type="checkbox" class="table-var-checkbox" data-var-id="gdp">
                <span>GDP Growth YoY</span>
              </label>
            </div>
          </div>
        </div>
        <!-- Color-code toggle separated on the right -->
        <label id="summary-color-toggle" class="table-option" style="align-self:flex-start;">
          <input type="checkbox" id="color-code-headers">
          <span>Color-code scenarios</span>
        </label>
      </div>
      <div id="summary-legend" style="margin-bottom:8px;font-size:11px;color:var(--muted);display:none;"></div>
      <div id="summary-tables"></div>
    </div>
  </section>
</main>




<!-- all the js that have been refactored -->
<script src="js/policy_dashboard.data.js"></script>
<script src="js/policy_dashboard.charts.js"></script>
<script src="js/policy_dashboard.summary.js"></script>
<script src="js/policy_dashboard.export.js"></script>
<script src="js/policy_dashboard.core.js"></script>



<footer class="site-footer">
  © 2025 Nick
</footer>
</body>
</html>